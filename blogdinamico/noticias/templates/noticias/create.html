{% extends 'base.html' %}

{% block content %}
<div class="form-container">
    <h2>Publicar Nova Notícia</h2>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <p class="{{ message.tags }}">{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <form action="{% url 'noticias:create' %}" method="post" class="news-form">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="titulo">Título da Notícia</label>
            <input type="text" id="titulo" name="titulo" required placeholder="Insira o título da notícia">
        </div>

        <div class="form-group">
            <label for="conteudo">Conteúdo</label>
            <textarea id="conteudo" name="conteudo" rows="5" required placeholder="Descreva o conteúdo da notícia"></textarea>
        </div>

        <div class="form-group">
            <label for="noticia_url">URL da Imagem</label>
            <input type="url" id="noticia_url" name="noticia_url" required placeholder="https://exemplo.com/imagem.jpg">
        </div>

        <div class="form-group">
            <label for="categorias">Categorias (Escolha até 3. Dica: use a tecla CTRL)</label>
            <select id="categorias" name="categorias" multiple required onchange="checkCategoryLimit()">
                <option value="tecnologia">Tecnologia</option>
                <option value="ciencia">Ciência</option>
                <option value="politica">Política</option>
                <option value="entretenimento">Entretenimento</option>
                <option value="esportes">Esportes</option>
                <option value="saude">Saúde</option>
            </select>
            <small id="category-limit-message" class="category-limit-message">Você só pode selecionar até 3 categorias.</small>
        </div>

        <div class="form-buttons">
            <button type="submit" class="btn btn-primary">Publicar Notícia</button>
            <a href="{% url 'noticias:index' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<script>
function checkCategoryLimit() {
    const select = document.getElementById("categorias");
    const selectedOptions = Array.from(select.selectedOptions);
    const message = document.getElementById("category-limit-message");

    // Exibe uma mensagem se o limite de 3 categorias for atingido
    if (selectedOptions.length > 3) {
        message.style.display = "block";
        // Remove a última seleção
        selectedOptions[selectedOptions.length - 1].selected = false;
    } else {
        message.style.display = "none";
    }
}
</script>
{% endblock content %}
